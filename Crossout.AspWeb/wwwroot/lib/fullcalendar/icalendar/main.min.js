/**
 * Minified by jsDelivr using Terser v5.10.0.
 * Original file: /npm/@fullcalendar/icalendar@5.11.0/main.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
/*!
FullCalendar v5.10.2
Docs & License: https://fullcalendar.io/
(c) 2021 Adam Shaw
*/
import{__assign}from"tslib";import{createPlugin,addDays}from"@fullcalendar/common";import*as ICAL from"ical.js";var IcalExpander=function(){function e(e){this.maxIterations=null!=e.maxIterations?e.maxIterations:1e3,this.skipInvalidDates=null!=e.skipInvalidDates&&e.skipInvalidDates,this.jCalData=ICAL.parse(e.ics),this.component=new ICAL.Component(this.jCalData),this.events=this.component.getAllSubcomponents("vevent").map((function(e){return new ICAL.Event(e)})),this.skipInvalidDates&&(this.events=this.events.filter((function(e){try{return e.startDate.toJSDate(),e.endDate.toJSDate(),!0}catch(e){return!1}})))}return e.prototype.between=function(e,t){var n=this;function r(n,r){return(!e||r>=e.getTime())&&(!t||n<=t.getTime())}function a(e){var t=e.startDate.toJSDate().getTime(),n=e.endDate.toJSDate().getTime();return e.endDate.isDate&&n>t&&(n-=1),{startTime:t,endTime:n}}var i=[];this.events.forEach((function(e){e.isRecurrenceException()&&i.push(e)}));var s={events:[],occurrences:[]};return this.events.filter((function(e){return!e.isRecurrenceException()})).forEach((function(e){var o=[];if(e.component.getAllProperties("exdate").forEach((function(e){var t=e.getFirstValue();o.push(t.toJSDate().getTime())})),e.isRecurring()){var c=e.iterator(),u=void 0,l=0,p=function(){if(l+=1,u=c.next()){var n=e.getOccurrenceDetails(u),p=a(n),d=p.startTime,f=p.endTime,m=-1!==o.indexOf(d),v=i.find((function(t){return t.uid===e.uid&&t.recurrenceId.toJSDate().getTime()===n.startDate.toJSDate().getTime()}));if(t&&d>t.getTime())return"break";r(d,f)&&(v?s.events.push(v):m||s.occurrences.push(n))}};do{if("break"===p())break}while(u&&(!n.maxIterations||l<n.maxIterations))}else{var d=a(e);r(d.startTime,d.endTime)&&s.events.push(e)}})),s},e.prototype.before=function(e){return this.between(void 0,e)},e.prototype.after=function(e){return this.between(e)},e.prototype.all=function(){return this.between()},e}(),eventSourceDef={parseMeta:function(e){return e.url&&"ics"===e.format?{url:e.url,format:"ics"}:null},fetch:function(e,t,n){var r=e.eventSource.meta,a=r.internalState;function i(r,a,i){r?n({message:r,xhr:i}):t({rawEvents:expandICalEvents(a,e.range),xhr:i})}!a||e.isRefetch?(a=r.internalState={completed:!1,callbacks:[i],errorMessage:"",iCalExpander:null,xhr:null},requestICal(r.url,(function(e,t){for(var n=new IcalExpander({ics:e,skipInvalidDates:!0}),r=0,i=a.callbacks;r<i.length;r++){(0,i[r])("",n,t)}a.completed=!0,a.callbacks=[],a.iCalExpander=n,a.xhr=t}),(function(e,t){for(var n=0,r=a.callbacks;n<r.length;n++){(0,r[n])(e,null,t)}a.completed=!0,a.callbacks=[],a.errorMessage=e,a.xhr=t}))):a.completed?i(a.errorMessage,a.iCalExpander,a.xhr):a.callbacks.push(i)}};function requestICal(e,t,n){var r=new XMLHttpRequest;r.open("GET",e,!0),r.onload=function(){r.status>=200&&r.status<400?t(r.responseText,r):n("Request failed",r)},r.onerror=function(){return n("Request failed",r)},r.send(null)}function expandICalEvents(e,t){for(var n=addDays(t.start,-1),r=addDays(t.end,1),a=e.between(n,r),i=[],s=0,o=a.events;s<o.length;s++){var c=o[s];i.push(__assign(__assign({},buildNonDateProps(c)),{start:c.startDate.toString(),end:specifiesEnd(c)&&c.endDate?c.endDate.toString():null}))}for(var u=0,l=a.occurrences;u<l.length;u++){var p=l[u];c=p.item;i.push(__assign(__assign({},buildNonDateProps(c)),{start:p.startDate.toString(),end:specifiesEnd(c)&&p.endDate?p.endDate.toString():null}))}return i}function buildNonDateProps(e){return{title:e.summary,url:extractEventUrl(e),extendedProps:{location:e.location,organizer:e.organizer,description:e.description}}}function extractEventUrl(e){var t=e.component.getFirstProperty("url");return t?t.getFirstValue():""}function specifiesEnd(e){return Boolean(e.component.getFirstProperty("dtend"))||Boolean(e.component.getFirstProperty("duration"))}var main=createPlugin({eventSourceDefs:[eventSourceDef]});export default main;
//# sourceMappingURL=/sm/70499474430638db04691427be9b3b565dcc91b3180bfe4d286b2d3fe0e557f8.map